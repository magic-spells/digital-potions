!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TweenCalculator=t()}(this,(function(){"use strict";return class{constructor(e){this.setKeyframes(e),this.discreteProperties=["display","position","float","clear","visibility","overflow","overflow-x","overflow-y","flex-direction","flex-wrap","justify-content","align-items","align-content","order","grid-template-columns","grid-template-rows","grid-template-areas","grid-auto-flow","z-index","table-layout","empty-cells","caption-side","list-style-type","list-style-position","pointer-events","user-select","box-sizing","resize","text-align","text-transform","white-space","word-break","word-wrap","font-style","font-weight","font-variant","background-repeat","background-attachment","background-position","border-style","border-collapse","content","page-break-before","page-break-after","page-break-inside"]}calculateTween(e){const t={},r=100*e,s=new Set(this.keyframes.flatMap((e=>Object.keys(e.styles))));for(const e of s)t[e]=this.interpolateProperty(e,r);return t}interpolateProperty(e,t){if(this.discreteProperties.includes(e))return this.interpolateDiscreteProperty(e,t);const r=this.keyframes.filter((t=>e in t.styles));if(0===r.length)return null;if(1===r.length)return r[0].styles[e];if(t<r[0].percent){const s=r[0],n=r[1]||r[0],a=(t-s.percent)/(n.percent-s.percent),o=s.styles[e],l=n.styles[e];return"transform"===e?this.extrapolateTransform(o,l,a,"below"):this.extrapolateValue(o,l,a,"below")}if(t>r[r.length-1].percent){const s=r.length-1,n=r[s-1]||r[s],a=r[s],o=(t-a.percent)/(a.percent-n.percent),l=n.styles[e],i=a.styles[e];return"transform"===e?this.extrapolateTransform(l,i,o,"above"):this.extrapolateValue(l,i,o,"above")}let s=r[0],n=r[r.length-1];for(let e=0;e<r.length-1;e++)if(t>=r[e].percent&&t<=r[e+1].percent){s=r[e],n=r[e+1];break}const a=s.styles[e],o=n.styles[e],l=(t-s.percent)/(n.percent-s.percent);return"transform"===e?this.interpolateTransform(a,o,l):this.interpolateValue(a,o,l)}extrapolateValue(e,t,r,s){const n=parseFloat(e),a=parseFloat(t);if(isNaN(n)||isNaN(a))return this.formatNumber("above"===s?t:e);let o;return o="above"===s?a+(a-n)*r:"below"===s?n+(n-a)*r:a,this.formatNumber(o)}extrapolateTransform(e,t,r,s){const n=this.parseTransform(e),a=this.parseTransform(t),o=[],l=new Set([...Object.keys(n),...Object.keys(a)]);for(const e of l){const t=n[e]||(this.isNumericFunction(e)?{value:0,unit:"px"}:{value:0,unit:""}),l=a[e]||{value:t.value,unit:t.unit};if(Array.isArray(t.value)){const n=t.value.map(((e,t)=>{const n=l.value[t]||{value:e.value,unit:e.unit};let a=e.value;return"above"===s?a+=(n.value-e.value)*r:"below"===s&&(a+=(e.value-n.value)*r),`${this.formatNumber(a)}${e.unit||""}`}));o.push(`${e}(${n.join(", ")})`)}else{let n=l.value;"above"===s?n+=(l.value-t.value)*r:"below"===s&&(n+=(t.value-l.value)*r),o.push(`${e}(${this.formatNumber(n)}${t.unit||""})`)}}return o.join(" ")}formatNumber(e){return e=parseFloat(e),parseFloat(e.toFixed(4)).toString()}interpolateDiscreteProperty(e,t){const r=this.keyframes.filter((t=>e in t.styles));if(0===r.length)return null;return r.reduce(((e,r)=>r.percent<=t&&r.percent>e.percent?r:e)).styles[e]}interpolateTransform(e,t,r){const s=this.parseTransform(e),n=this.parseTransform(t),a=[],o=new Set([...Object.keys(s),...Object.keys(n)]);for(const e of o){const t=s[e]||(this.isNumericFunction(e)?{value:0,unit:"px"}:{value:0,unit:""}),o=n[e]||{value:t.value,unit:t.unit};if(Array.isArray(t.value)){const s=t.value.map(((e,t)=>{const s=o.value[t]||{value:e.value,unit:e.unit},n=this.interpolateValue(e.value,s.value,r,!0);return`${this.formatNumber(n)}${e.unit||""}`}));a.push(`${e}(${s.join(", ")})`)}else{const s=this.interpolateValue(t.value,o.value,r,!0);a.push(`${e}(${this.formatNumber(s)}${t.unit||""})`)}}return a.join(" ")}parseTransform(e){const t={},r=/(\w+)\(([^)]+)\)/g;let s;for(;null!==(s=r.exec(e));){const[,e,r]=s,n=r.split(/\s*,\s*|\s+/).map((e=>{const t=e.match(/^(-?\d*\.?\d+)(\D*)$/);return t?{value:parseFloat(t[1]),unit:t[2]}:{value:0,unit:""}}));n.length>1?t[e]=n:t[e]=n[0]}return t}interpolateValue(e,t,r,s=!1){if(this.isColor(e)&&this.isColor(t))return this.interpolateColor(e,t,r);if("number"==typeof e&&"number"==typeof t){const s=e+(t-e)*r;return this.formatNumber(s)}const n=this.parseValue(e),a=this.parseValue(t);if(n&&a&&n.unit===a.unit){let e=(n.value+(a.value-n.value)*r).toFixed(2);return e=e.replace(/\.00$/,"").replace(/(\.\d)0$/,"$1"),`${e}${n.unit||""}`}return r<1?e:t}parseValue(e){if("number"==typeof e)return{value:e,unit:""};const t=String(e).match(/^(-?\d*\.?\d+)(\D*)$/);return t?{value:parseFloat(t[1]),unit:t[2]}:null}isColor(e){return/^(#[0-9A-Fa-f]{6}|rgb\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*\)|rgba\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*,\s*[\d.]+\s*\)|hsl\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*\)|hsla\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*,\s*[\d.]+\s*\))$/.test(e)}interpolateColor(e,t,r){const s=this.colorToRGB(e),n=this.colorToRGB(t),a=Math.round(s[0]+(n[0]-s[0])*r),o=Math.round(s[1]+(n[1]-s[1])*r),l=Math.round(s[2]+(n[2]-s[2])*r),i=e=>Math.max(0,Math.min(255,e));return`#${((1<<24)+(i(a)<<16)+(i(o)<<8)+i(l)).toString(16).slice(1).toUpperCase()}`}colorToRGB(e){if(e.startsWith("#"))return[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)];const t=e.match(/^rgb\s*\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)$/);if(t)return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)];const r=e.match(/^rgba\s*\(\s*(\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\s*\)$/);if(r)return[parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10)];if(e.match(/^hsl\s*\(\s*(\d+),\s*(\d+)%?,\s*(\d+)%?\s*\)$/))return this.hslToRGB(e);return e.match(/^hsla\s*\(\s*(\d+),\s*(\d+)%?,\s*(\d+)%?,\s*[\d.]+\s*\)$/)?this.hslToRGB(e):[0,0,0]}hslToRGB(e){const t=e.match(/^hsl[a]?\(\s*(\d+),\s*(\d+)%?,\s*(\d+)%?\s*\)$/);if(!t)return[0,0,0];let r=parseInt(t[1],10),s=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100;r%=360,r<0&&(r+=360);const a=(1-Math.abs(2*n-1))*s,o=a*(1-Math.abs(r/60%2-1)),l=n-a/2;let i,u,c;[i,u,c]=0<=r&&r<60?[a,o,0]:60<=r&&r<120?[o,a,0]:120<=r&&r<180?[0,a,o]:180<=r&&r<240?[0,o,a]:240<=r&&r<300?[o,0,a]:[a,0,o];return[Math.round(255*(i+l)),Math.round(255*(u+l)),Math.round(255*(c+l))]}setKeyframes(e){this.keyframes=e.sort(((e,t)=>e.percent-t.percent))}isNumericFunction(e){return["translate","translateX","translateY","translateZ","scale","scaleX","scaleY","scaleZ","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY","perspective"].includes(e)}interpolateDiscreteProperty(e,t){const r=this.keyframes.filter((t=>e in t.styles));if(0===r.length)return null;return r.reduce(((e,r)=>r.percent<=t&&r.percent>e.percent?r:e)).styles[e]}}}));
