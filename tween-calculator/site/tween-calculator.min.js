!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TweenCalculator=t()}(this,(function(){"use strict";return class{constructor(e){this.setKeyframes(e),this.discreteProperties=["display","position","float","clear","visibility","overflow","overflow-x","overflow-y","flex-direction","flex-wrap","justify-content","align-items","align-content","order","grid-template-columns","grid-template-rows","grid-template-areas","grid-auto-flow","z-index","table-layout","empty-cells","caption-side","list-style-type","list-style-position","pointer-events","user-select","box-sizing","resize","text-align","text-transform","white-space","word-break","word-wrap","font-style","font-weight","font-variant","background-repeat","background-attachment","background-position","border-style","border-collapse","content","page-break-before","page-break-after","page-break-inside"]}calculateTween(e){const t={},r=100*e,n=new Set(this.keyframes.flatMap((e=>Object.keys(e.styles))));for(const e of n)t[e]=this.interpolateProperty(e,r);return t}interpolateProperty(e,t){if(this.discreteProperties.includes(e))return this.interpolateDiscreteProperty(e,t);const r=this.keyframes.filter((t=>e in t.styles));if(0===r.length)return null;const n=r[0],s=r[r.length-1];if(t<n.percent)return this.handleExtrapolation(e,t,n,r[1]||n,"below");if(t>s.percent)return this.handleExtrapolation(e,t,r[r.length-2]||s,s,"above");{const{startFrame:n,endFrame:s}=this.findSurroundingKeyframes(r,t);return this.handleInterpolation(e,t,n,s)}}handleExtrapolation(e,t,r,n,s){const a=(t-r.percent)/(n.percent-r.percent),i=r.styles[e],o=n.styles[e];return"transform"===e?this.extrapolateTransform(i,o,a,s):this.interpolateNumericValues(i,o,a,s)}handleInterpolation(e,t,r,n){const s=(t-r.percent)/(n.percent-r.percent),a=r.styles[e],i=n.styles[e];return"transform"===e?this.interpolateTransform(a,i,s):"filter"===e?this.interpolateFilter(a,i,s):this.interpolateValue(a,i,s)}interpolateFilter(e,t,r){const n=this.parseFilter(e),s=this.parseFilter(t),a=[],i=new Set([...Object.keys(n),...Object.keys(s)]);for(const e of i){const t=n[e]||{value:0,unit:this.getDefaultFilterUnit(e)},i=s[e]||{value:t.value,unit:t.unit},o=this.interpolateValue(t.value,i.value,r);a.push(`${e}(${o}${t.unit})`)}return a.join(" ")}parseFilter(e){const t={},r=/(\w+)\(([^)]+)\)/g;let n;for(;null!==(n=r.exec(e));){const[,e,r]=n,{value:s,unit:a}=this.parseValue(r);t[e]={value:s,unit:a}}return t}getDefaultFilterUnit(e){switch(e){case"blur":return"px";case"hue-rotate":return"deg";default:return"%"}}interpolateTransform(e,t,r){const n=this,s=n.parseTransform(e),a=n.parseTransform(t),i=[],o=new Set([...Object.keys(s),...Object.keys(a)]);for(const e of o){const t=s[e]||(n.isNumericFunction(e)?{value:0,unit:"px"}:{value:0,unit:""}),o=a[e]||{value:t.value,unit:t.unit};if(Array.isArray(t.value)){const s=t.value.map(((e,t)=>{const s=void 0!==o.value[t]?o.value[t]:{value:e.value,unit:e.unit};return`${n.interpolateValue(e.value,s.value,r,!0)}${e.unit||""}`}));i.push(`${e}(${s.join(", ")})`)}else{const s=n.interpolateValue(t.value,o.value,r,!0);i.push(`${e}(${s}${t.unit||""})`)}}return i.join(" ")}findSurroundingKeyframes(e,t){let r=e[0],n=e[e.length-1];for(let s=0;s<e.length-1;s++)if(t>=e[s].percent&&t<=e[s+1].percent){r=e[s],n=e[s+1];break}return{startFrame:r,endFrame:n}}interpolateNumericValues(e,t,r){const n=this.parseValue(e),s=this.parseValue(t);if(n&&s&&n.unit===s.unit){const e=n.value+(s.value-n.value)*r;return`${this.formatNumber(e)}${n.unit||""}`}return r<1?e:t}interpolateValue(e,t,r){return this.isColor(e)&&this.isColor(t)?this.interpolateColor(e,t,r):"number"==typeof e&&"number"==typeof t?this.formatNumber(e+(t-e)*r):this.interpolateNumericValues(e,t,r)}extrapolateTransform(e,t,r,n){const s=this.parseTransform(e),a=this.parseTransform(t),i=[],o=new Set([...Object.keys(s),...Object.keys(a)]);for(const e of o){const t=s[e]||{value:0,unit:"px"},n=a[e]||{value:t.value,unit:t.unit};if(Array.isArray(t.value)){const s=t.value.map(((e,t)=>{const s=n.value[t]||{value:e.value,unit:e.unit};return this.formatNumber(e.value+(s.value-e.value)*r)}));i.push(`${e}(${s.join(", ")})`)}else{const s=this.formatNumber(t.value+(n.value-t.value)*r);i.push(`${e}(${s}${t.unit||""})`)}}return i.join(" ")}parseTransform(e){const t={},r=/(\w+)\(([^)]+)\)/g;let n;for(;null!==(n=r.exec(e));){const[,e,r]=n,s=r.split(/\s*,\s*|\s+/).map((e=>{const t=e.match(/^(-?\d*\.?\d+)(\D*)$/);return t?{value:parseFloat(t[1]),unit:t[2]}:{value:0,unit:""}}));t[e]=s.length>1?s:s[0]}return t}formatNumber(e){return parseFloat(Number(e).toFixed(4)).toString()}interpolateDiscreteProperty(e,t){const r=this.keyframes.filter((t=>e in t.styles));if(0===r.length)return null;return r.reduce(((e,r)=>r.percent<=t&&r.percent>e.percent?r:e)).styles[e]}setKeyframes(e){this.keyframes=e.sort(((e,t)=>e.percent-t.percent))}isColor(e){return/^(#[0-9A-Fa-f]{6}|rgb|hsl|rgba|hsla)/.test(e)}interpolateColor(e,t,r){const n=this.colorToRGB(e),s=this.colorToRGB(t);return`rgb(${Math.round(n[0]+(s[0]-n[0])*r)},${Math.round(n[1]+(s[1]-n[1])*r)},${Math.round(n[2]+(s[2]-n[2])*r)})`}colorToRGB(e){return e.startsWith("#")?[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]:[0,0,0]}parseValue(e){if("number"==typeof e)return{value:e,unit:""};const t=String(e).match(/^(-?\d*\.?\d+)(\D*)$/);return t?{value:parseFloat(t[1]),unit:t[2]}:null}}}));
